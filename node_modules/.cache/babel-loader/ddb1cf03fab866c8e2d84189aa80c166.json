{"ast":null,"code":"import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import _regeneratorRuntime from\"D:/Assignments/React/amzon-clone/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/Assignments/React/amzon-clone/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:/Assignments/React/amzon-clone/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import'./Payment.css';import Checkoutproduct from'./Checkoutproduct';import{useStateValue}from'./StateProvider';import{Link,useHistory}from'react-router-dom';import{useElements,useStripe,CardElement}from'@stripe/react-stripe-js';import CurrencyFormat from'react-currency-format';import{getBasketTotal}from'./reducer';import axios from'./axios';var Payment=function Payment(){var _useStateValue=useStateValue(),_useStateValue2=_slicedToArray(_useStateValue,2),_useStateValue2$=_useStateValue2[0],basket=_useStateValue2$.basket,user=_useStateValue2$.user,dispatch=_useStateValue2[1];var history=useHistory();var stripe=useStripe();var elements=useElements();var _useState=useState(false),_useState2=_slicedToArray(_useState,2),succeeded=_useState2[0],setSucceeded=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),processing=_useState4[0],setProcessing=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),error=_useState6[0],setError=_useState6[1];var _useState7=useState(true),_useState8=_slicedToArray(_useState7,2),disabled=_useState8[0],setDisabled=_useState8[1];var _useState9=useState(true),_useState10=_slicedToArray(_useState9,2),clientSecret=_useState10[0],setClientSecret=_useState10[1];useEffect(function(){var getClientSecret=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios({method:'post',url:\"/payments/create?total=\".concat(getBasketTotal(basket)*100)});case 2:response=_context.sent;setClientSecret(response.data.clientSecret);case 4:case\"end\":return _context.stop();}}},_callee);}));return function getClientSecret(){return _ref.apply(this,arguments);};}();getClientSecret();},[basket]);var handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e){var payload;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:e.preventDefault();setProcessing(true);_context2.next=4;return stripe.confirmCardPayment(clientSecret,{payment_method:{card:elements.getElement(CardElement)}}).then(function(_ref3){var paymentIntent=_ref3.paymentIntent;// paymentIntent = payment confirmation\nsetSucceeded(true);error(null);setProcessing(false);history.replace('/orders');});case 4:payload=_context2.sent;case 5:case\"end\":return _context2.stop();}}},_callee2);}));return function handleSubmit(_x){return _ref2.apply(this,arguments);};}();var handleChange=function handleChange(e){setDisabled(e.empty);setError(e.error?e.error.message:\"\");};return/*#__PURE__*/_jsxs(\"div\",{className:\"payment\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"payment_container\",children:/*#__PURE__*/_jsxs(\"h1\",{children:[\"Checkout (\",/*#__PURE__*/_jsxs(Link,{to:\"/checkout\",children:[basket===null||basket===void 0?void 0:basket.length,\" items\"]}),\")\"]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment_section\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"payment_title\",children:/*#__PURE__*/_jsx(\"h3\",{children:\"Delievery Address:\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment_address\",children:[/*#__PURE__*/_jsx(\"p\",{children:user===null||user===void 0?void 0:user.email}),/*#__PURE__*/_jsx(\"p\",{children:\"North karachi\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Sindh\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment_section\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"payment_title\",children:/*#__PURE__*/_jsx(\"h3\",{children:\"Review items and delivery\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"payment_items\",children:basket.map(function(item){return/*#__PURE__*/_jsx(Checkoutproduct,{id:item.title,image:item.image,price:item.price,rating:item.rating});})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment_section\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"payment_title\",children:/*#__PURE__*/_jsx(\"h3\",{children:\"Payment Method\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"payment_details\",children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(CardElement,{onChange:handleChange}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment_priceContainer\",children:[/*#__PURE__*/_jsx(CurrencyFormat,{renderText:function renderText(value){return/*#__PURE__*/_jsxs(\"h3\",{children:[\"Total Order:\",value]});},decimalScale:2,value:getBasketTotal(basket),displayType:\"text\",thousandSeparator:true,prefix:\"$\"}),/*#__PURE__*/_jsx(\"button\",{disabled:processing||disabled||succeeded,children:/*#__PURE__*/_jsx(\"span\",{children:processing?/*#__PURE__*/_jsx(\"p\",{children:\"processing\"}):\"Buy Now\"})})]}),error&&/*#__PURE__*/_jsx(\"div\",{children:error})]})})]})]});};export default Payment;","map":{"version":3,"sources":["D:/Assignments/React/amzon-clone/src/Payment.js"],"names":["React","useState","useEffect","Checkoutproduct","useStateValue","Link","useHistory","useElements","useStripe","CardElement","CurrencyFormat","getBasketTotal","axios","Payment","basket","user","dispatch","history","stripe","elements","succeeded","setSucceeded","processing","setProcessing","error","setError","disabled","setDisabled","clientSecret","setClientSecret","getClientSecret","method","url","response","data","handleSubmit","e","preventDefault","confirmCardPayment","payment_method","card","getElement","then","paymentIntent","replace","payload","handleChange","empty","message","length","email","map","item","title","image","price","rating","value"],"mappings":"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","sourcesContent":["import React, { useState,useEffect } from 'react'\r\nimport './Payment.css'\r\nimport Checkoutproduct from './Checkoutproduct';\r\nimport { useStateValue } from './StateProvider'\r\nimport { Link , useHistory } from 'react-router-dom'\r\nimport { useElements, useStripe, CardElement } from '@stripe/react-stripe-js';\r\nimport CurrencyFormat from 'react-currency-format';\r\nimport {getBasketTotal} from './reducer'\r\nimport axios from './axios';\r\n\r\nconst Payment = () => {\r\n    const [{ basket, user }, dispatch] = useStateValue();\r\n    const history = useHistory();\r\n\r\n    const stripe = useStripe();\r\n    const elements = useElements();\r\n\r\n    const[succeeded , setSucceeded] = useState(false);\r\n    const [processing ,setProcessing] = useState(\"\")\r\n\r\n\r\n    const [error, setError] = useState(null);\r\n    const [disabled, setDisabled] = useState(true);\r\n    const [clientSecret, setClientSecret] = useState(true);\r\n\r\n    \r\n    useEffect(() => {\r\n        const getClientSecret = async ()=>{\r\n            const response = await axios({\r\n                method:'post',\r\n                url:`/payments/create?total=${getBasketTotal(basket)* 100}`\r\n            });\r\n            setClientSecret(response.data.clientSecret)\r\n        }\r\n        getClientSecret();\r\n        \r\n    }, [basket])\r\n\r\n\r\n    \r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault();\r\n        setProcessing(true);\r\n\r\n        const payload = await stripe.confirmCardPayment(clientSecret,{\r\n            payment_method:{\r\n                card:elements.getElement(CardElement)\r\n            }\r\n        }).then(({paymentIntent})=>{\r\n            // paymentIntent = payment confirmation\r\n            setSucceeded(true);\r\n            error(null);\r\n            setProcessing(false)\r\n            history.replace('/orders')\r\n                \r\n        })\r\n\r\n    }\r\n\r\n    const handleChange = e => {\r\n        setDisabled(e.empty);\r\n        setError(e.error ? e.error.message : \"\");\r\n    }\r\n\r\n    return (\r\n        <div className=\"payment\">\r\n            <div className=\"payment_container\">\r\n                <h1>\r\n                    Checkout (<Link to='/checkout'>{basket?.length} items</Link>)\r\n                </h1>\r\n            </div>\r\n            <div className='payment_section'>\r\n                <div className='payment_title'>\r\n                    <h3>Delievery Address:</h3>\r\n                </div>\r\n                <div className='payment_address'>\r\n                    <p>{user?.email}</p>\r\n                    <p>North karachi</p>\r\n                    <p>Sindh</p>\r\n                </div>\r\n\r\n            </div>\r\n            <div className='payment_section'>\r\n                <div className='payment_title'>\r\n                    <h3>Review items and delivery</h3>\r\n                </div>\r\n                <div className='payment_items'>\r\n                    {basket.map(item => (\r\n                        <Checkoutproduct\r\n                            id={item.title}\r\n                            image={item.image}\r\n                            price={item.price}\r\n                            rating={item.rating}\r\n\r\n                        />\r\n                    ))}\r\n                </div>\r\n\r\n            </div>\r\n            <div className='payment_section'>\r\n                <div className='payment_title'>\r\n                    <h3>Payment Method</h3>\r\n                </div>\r\n                <div className='payment_details'>\r\n                    <form onSubmit={handleSubmit}>\r\n                        <CardElement onChange={handleChange} />\r\n                        <div className='payment_priceContainer'>\r\n                            <CurrencyFormat\r\n                             renderText={(value)=>(\r\n                                <h3>Total Order:{value }</h3>\r\n                            )}\r\n                               decimalScale={2}\r\n                               value={getBasketTotal(basket)}\r\n                               displayType={\"text\"}\r\n                               thousandSeparator={true}\r\n                               prefix={\"$\"}\r\n                            />\r\n                            <button disabled={processing || disabled ||succeeded}>\r\n                                <span>{processing?<p>processing</p>:\"Buy Now\"}</span>\r\n                            </button>\r\n                               \r\n                        </div>\r\n                        {/* For Errors */}\r\n                        {error && <div>{error}</div>}\r\n                    </form>\r\n\r\n                </div>\r\n            </div>\r\n\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default Payment \r\n"]},"metadata":{},"sourceType":"module"}